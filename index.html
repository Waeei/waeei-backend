<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>فحص الرابط</title>
</head>
<body style="font-family: system-ui; padding: 24px;">
  <h1>فحص الرابط</h1>

  <input id="urlInput" type="text" placeholder="الصقي الرابط هنا"
         style="width:100%;max-width:520px;padding:10px;border:1px solid #ccc;border-radius:8px;">
  <button id="checkBtn" style="margin-top:10px;padding:10px 16px;border-radius:8px;">تحقّق</button>

  <div id="result" style="margin-top:12px;font-weight:700;display:none;"></div>

  <script>
    const BACKEND = "http://127.0.0.1:8000/analyze-link";

    function isSuspicious(verdict){
      const v = String(verdict || "").toLowerCase();
      return v.includes("malicious") || v.includes("phish") || v.startsWith("error");
    }

    document.getElementById("checkBtn").addEventListener("click", async () => {
      const url = document.getElementById("urlInput").value.trim();
      const box = document.getElementById("result");
      if (!url) { alert("أدخلي الرابط"); return; }

      try {
        const res = await fetch(BACKEND, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url })
        });

        const data = await res.json();                 
        const verdict = data.verdict || data.final_verdict || "unknown";

        if (isSuspicious(verdict)) {
          const q = new URLSearchParams({
            url: data.url || url,
            verdict,
            reasons: (data.reasons || []).join(" | ")
          });
          window.location.href = "warning.html?" + q.toString();
        } else {
          box.style.display = "block";
          box.textContent = "الرابط آمن ✔";
        }
      } catch (e) {
        alert("ما قدرت أتصل بالسيرفر: " + e.message);
      }
    });
  </script>
</body>
</html>