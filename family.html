
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø±Ø© - Ù…Ù†ØµØ© ÙˆØ§Ø¹ÙŠ</title>

<style>
body {font-family:'Tajawal',sans-serif;margin:0;background:#f7f7f7;color:#111;}
header{background:#fff;border-bottom:1px solid #eee;padding:20px;text-align:center;}
h1{margin:0;color:#0aa06e;}
.container{max-width:900px;margin:20px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 0 8px #ddd;}
input,select,button{padding:10px;border-radius:8px;border:1px solid #ccc;font:inherit;width:100%;box-sizing:border-box;}
button{background:#0aa06e;color:#fff;border:none;cursor:pointer;}
button:hover{opacity:0.9;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #eee;padding:8px;text-align:center;}
th{background:#f4f4f4;}
.mal{color:#c73535;}
</style>
</head>
<body>

<header>
  <h1>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø±Ø© - Ù…Ù†ØµØ© ÙˆØ§Ø¹ÙŠ</h1>
  <p>Ø³Ø§Ø¹Ø¯ Ø£Ø³Ø±ØªÙƒ Ø¹Ù„Ù‰ ÙØ­Øµ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙˆØµÙŠØ©</p>
</header>

<div class="container">

  <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ÙØªØ­ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø±Ø©</h2>
  <input id="familyName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø±Ø© (Ù…Ø«Ø§Ù„: Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ)">
  <button onclick="saveFamily()">Ø§Ø¨Ø¯Ø£</button>
  <p id="welcome"></p>
  <hr>

  <h2>Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¬Ø¯ÙŠØ¯</h2>
  <input id="memberName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¯ (Ø£Ø¨ / Ø£Ù… / Ø§Ø¨Ù†)">
  <input id="linkInput" placeholder="Ø£Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§">
  <button onclick="checkLink()">ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù†</button>
  <div id="loading" style="display:none;color:#0aa06e;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>

  <div id="resultBox" style="display:none;margin-top:10px;padding:10px;border:1px solid #eee;border-radius:10px;">
    <h3>Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ:</h3>
    <p id="verdict"></p>
    <p id="reason" style="color:#666;"></p>
  </div>
  <hr>

  <h2>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø±Ø©</h2>
  <table>
    <thead>
      <tr><th>Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¯</th><th>Ø§Ù„Ø±Ø§Ø¨Ø·</th><th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th><th>Ø§Ù„ÙˆÙ‚Øª</th></tr>
    </thead>
    <tbody id="familyTable"></tbody>
  </table>

</div>

<script>
const BACKEND_BASE_URL = "http://127.0.0.1:8000";
const USE_MOCK = true; 

let familyName = localStorage.getItem("familyName") || "";
let familyData = JSON.parse(localStorage.getItem("familyData") || "[]");

function saveFamily(){
  const name = document.getElementById("familyName").value.trim();
  if(!name){ alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹"); return; }
  familyName = name;
  localStorage.setItem("familyName", name);
  document.getElementById("welcome").textContent = "Ù…Ø±Ø­Ø¨Ù‹Ø§ " + familyName + "!";
  renderTable();
}

if(familyName){ document.getElementById("welcome").textContent = "Ù…Ø±Ø­Ø¨Ù‹Ø§ " + familyName + "!"; }

async function checkLink(){
  const member = document.getElementById("memberName").value.trim();
  const url = document.getElementById("linkInput").value.trim();
  if(!familyName) return alert("Ø³Ø¬Ù‘Ù„ Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹");
  if(!member || !url) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¯ ÙˆØ§Ù„Ø±Ø§Ø¨Ø·");
  document.getElementById("loading").style.display="block";
  document.getElementById("resultBox").style.display="none";

  let verdict=""; let reason="";
  try{
    const res = await fetch(BACKEND_BASE_URL+"/analyze-link",{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({url})
    });
    if(!res.ok) throw new Error();
    const data = await res.json();
    verdict = data.verdict || "Unknown";
    reason  = data.reason  || "";
  }catch(e){
    if(USE_MOCK){
      const bad=/login|bank|verify|free|gift|xyz|tinyurl|short/i.test(url);
      verdict = bad?"Malicious":"Safe";
      reason  = bad?"Ø§Ù„Ù†Ø¸Ø§Ù… Ø§ÙƒØªØ´Ù Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ø­ØªÙŠØ§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·":"Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø§ ÙŠØ¸Ù‡Ø± Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ø­ØªÙŠØ§Ù„ ÙˆØ§Ø¶Ø­Ø©";
    }else{
      alert("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…"); 
      document.getElementById("loading").style.display="none"; 
      return;
    }
  }

  document.getElementById("loading").style.display="none";
  document.getElementById("resultBox").style.display="block";
  document.getElementById("verdict").innerHTML = verdict==="Safe"
      ? `<span class='safe'>Ø¢Ù…Ù† âœ…</span>` : `<span class='mal'>Ø§Ø­ØªÙŠØ§Ù„ÙŠ âš ï¸</span>`;
  document.getElementById("reason").textContent = reason;

  const record={familyName,name:member,url,verdict,date:new Date().toLocaleString()};
  familyData.push(record);
  localStorage.setItem("familyData", JSON.stringify(familyData));
  renderTable();
}

function renderTable(){
  const tbody=document.getElementById("familyTable");
  tbody.innerHTML="";
  familyData.filter(x=>x.familyName===familyName).slice().reverse().forEach(r=>{
    const row=`<tr>
      <td>${r.name}</td>
      <td style="direction:ltr">${r.url}</td>
      <td>${r.verdict==="Safe"?"<span class='safe'>Ø¢Ù…Ù† âœ…</span>":"<span class='mal'>Ø§Ø­ØªÙŠØ§Ù„ÙŠ âš ï¸</span>"}</td>
      <td>${r.date}</td>
    </tr>`;
    tbody.innerHTML+=row;
  });
}

renderTable();
</script>

</body>
</html>
